generator client {
  provider = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "mysql"
  url                  = env("DATABASE_URL")
  shadowDatabaseUrl    = env("SHADOW_DATABASE_URL")
  referentialIntegrity = "prisma"
}

model User {
  id            Int            @id @default(autoincrement())
  email         String         @unique
  name          String
  avatar        String
  password      String
  updatedAt     DateTime?      @updatedAt
  createdAt     DateTime
  session       Session?
  shoppingLists ShoppingList[]
  shoppingItems ShoppingItem[]
}

model Session {
  id                    Int     @id @default(autoincrement())
  userId                Int     @unique
  refreshToken          String
  refreshTokenExpiresAt String?
  user                  User?   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ShoppingList {
  id            Int                  @id @default(autoincrement())
  name          String
  status        String
  createdAt     DateTime
  updatedAt     DateTime             @updatedAt
  user          User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        Int
  shoppingItems ShoppingItemToList[]
}

model ShoppingItem {
  id            Int                  @id @default(autoincrement())
  name          String
  note          String?
  imageUrl      String?
  category      String
  createdAt     DateTime
  user          User?                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        Int
  shoppingLists ShoppingItemToList[]
}

model ShoppingItemToList {
  shoppingItem   ShoppingItem @relation(fields: [shoppingItemId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  shoppingItemId Int
  shoppingList   ShoppingList @relation(fields: [shoppingListId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  shoppingListId Int
  quantity       Int
  itemName           String
  itemCategory       String
  assignedBy     Int
  assignedAt     DateTime
  itemPurchased  Boolean

  @@id([shoppingListId, shoppingItemId])
}
